<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Koraa - Dashboard</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/scrollbar/scrollbar.css">
    <link rel="stylesheet" type="text/css" href="/assets/vendors/date-picker/date-picker.css">
    <link rel="stylesheet" type="text/css" href="/assets/vendors/owlcarousel/owlcarousel.css">
    <link rel="stylesheet" type="text/css" href="/assets/vendors/prism/prism.css">
    <link rel="stylesheet" type="text/css" href="/assets/vendors/bootstrap/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/style.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/responsive.css">

    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.4.0/fonts/remixicon.css" rel="stylesheet">
</head>

<body>
    <!-- tap on top starts-->
    <div class="tap-top"><i data-feather="chevrons-up"></i></div>
    <!-- tap on tap ends-->

    <!-- Loader starts-->
    <div class="loader-wrapper">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"> </div>
        <div class="dot"></div>
    </div>
    <!-- Loader ends-->

    <!-- page-wrapper Start-->
    <div class="page-wrapper compact-wrapper" id="pageWrapper">
        <!-- Page Header Start-->
        <div id="header"></div>
        <!-- Page Header Ends-->
        <!-- Page Body Start-->
        <div class="page-body-wrapper">
            <!-- Page Sidebar Start-->
            <div id="sidebar"></div>
            <!-- Page Sidebar Ends-->
            <div class="page-body">
                <div class="container-fluid">
                    <div class="page-title">
                        <div class="row">
                            <div class="col-sm-6">
                                <h3>
                                    File Manager</h3>
                            </div>
                            <div class="col-sm-6">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="index.html"><i data-feather="home"></i></a>
                                    </li>
                                    <li class="breadcrumb-item">Apps</li>
                                    <li class="breadcrumb-item active"> File Manager</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Container-fluid starts-->
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-xl-3 box-col-30">

                            <div class="md-sidebar-aside custom-scrollbar">
                                <div class="file-sidebar">
                                    <div class="card">
                                        <div class="card-body" id="totalSizeInfo">
                                            <ul>
                                                <li>
                                                    <div class="btn btn-outline-primary"><i data-feather="database">
                                                        </i>Storage </div>
                                                    <div class="m-t-15">
                                                        <div class="progress sm-progress-bar mb-3">
                                                            <div class="progress-bar bg-primary" role="progressbar"
                                                                style="width: 0%" aria-valuenow="0" aria-valuemin="0"
                                                                aria-valuemax="100"></div>
                                                        </div>
                                                        <h6 class="f-w-500">loading of 100 GB used</h6>
                                                    </div>
                                                </li>
                                            </ul>
                                            <hr>
                                            <ul>
                                                <li>
                                                    <div class="btn btn-outline-primary"><i data-feather="grid"></i>Pricing plan</div>
                                                </li>
                                                <li> </li>
                                                <div class="pricing-plan">
                                                    <h6>Trial Version </h6>
                                                    <h5>FREE</h5>
                                                    <p>100 GB Space</p>
                                                    <div class="btn btn-outline-primary btn-xs">Selected</div><img
                                                        class="bg-img" src="../assets/images/dashboard/folder.png"
                                                        alt="">
                                                </div>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-9 col-md-12 box-col-70">
                            <div class="file-content">
                                <div class="card">
                                    <div class="card-body file-manager">
                                        <h5 class="mt-4">Files </h5>
                                        <ul class="d-flex flex-row files-content" id="fileList">
                                            <li class="folder-box d-flex align-items-center">
                                                <div class="d-flex align-items-center files-list">
                                                    <div class="flex-shrink-0 file-left"><i
                                                            class="f-22 fa fa-folder font-info"></i></div>
                                                    <div class="flex-grow-1 ms-3">
                                                        <h6>Logo.psd</h6>
                                                        <p>7 Hour ago, 2.0 MB</p>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="folder-box d-flex align-items-center">
                                                <div class="d-flex align-items-center files-list">
                                                    <div class="flex-shrink-0 file-left"><i
                                                            class="f-22 fa fa-file-excel-o font-success"></i></div>
                                                    <div class="flex-grow-1 ms-3">
                                                        <h6>Backend.xls</h6>
                                                        <p>2 Day ago, 3.0 GB</p>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="folder-box d-flex align-items-center">
                                                <div class="d-flex align-items-center files-list">
                                                    <div class="flex-shrink-0 file-left"><i
                                                            class="f-22 fa fa-file-archive-o font-warning"></i></div>
                                                    <div class="flex-grow-1 ms-3">
                                                        <h6>Project.zip</h6>
                                                        <p>1 Day ago, 1.9 GB</p>
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="folder-box d-flex align-items-center">
                                                <div class="d-flex align-items-center files-list">
                                                    <div class="flex-shrink-0 file-left"><i
                                                            class="f-22 fa fa-folder font-primary"></i></div>
                                                    <div class="flex-grow-1 ms-3">
                                                        <h6>Report.txt</h6>
                                                        <p>1 Day ago, 0.9 KB</p>
                                                    </div>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Container-fluid Ends-->
            </div>
            <!-- footer start-->
            <footer id="footer"></footer>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <!-- latest jquery-->
    <script src="/assets/js/jquery-3.6.0.min.js"></script>
    <!-- Bootstrap js-->
    <script src="/assets/vendors/bootstrap/bootstrap.bundle.min.js"></script>
    <!-- feather icon js-->
    <script src="/assets/vendors/icons/feather-icon/feather.min.js"></script>
    <script src="/assets/vendors/icons/feather-icon/feather-icon.js"></script>
    <!-- scrollbar js-->
    <script src="/assets/js/scrollbar/simplebar.js"></script>
    <script src="/assets/js/scrollbar/custom.js"></script>
    <!-- Sidebar jquery-->
    <script src="/assets/js/config.js"></script>
    <script src="/assets/js/sidebar-menu.js"></script>
    <script src="/assets/vendors/prism/prism.min.js"></script>
    <script src="/assets/js/clipboard/clipboard.min.js"></script>
    <script src="/assets/js/counter/jquery.waypoints.min.js"></script>
    <script src="/assets/js/counter/jquery.counterup.min.js"></script>
    <script src="/assets/js/counter/counter-custom.js"></script>
    <script src="/assets/js/custom-card/custom-card.js"></script>
    <script src="/assets/vendors/date-picker/datepicker.js"></script>
    <script src="/assets/vendors/date-picker/datepicker.en.js"></script>
    <script src="/assets/vendors/date-picker/datepicker.custom.js"></script>
    <script src="/assets/vendors/owlcarousel/owl.carousel.js"></script>
    <script src="/assets/js/general-widget.js"></script>
    <script src="/assets/js/height-equal.js"></script>
    <script src="/assets/js/script.js"></script>
    <script src="/assets/js/theme-customizer/customizer.js"></script>

    <script>
        // Konfigurasi Firebase
        var firebaseConfig = {
            apiKey: "AIzaSyA_2_DrjTzs1cIOY9_5mloWYcdLxpsFq5c",
  authDomain: "koraa-id.firebaseapp.com",
  databaseURL: "https://koraa-id-default-rtdb.firebaseio.com",
  projectId: "koraa-id",
  storageBucket: "koraa-id.appspot.com",
  messagingSenderId: "360256061577",
  appId: "1:360256061577:web:5d9dbb92ff3313c7b48658",
  measurementId: "G-VJT00SD3NT"
        };
      
        // Inisialisasi Firebase
        firebase.initializeApp(firebaseConfig);
      
        // Memeriksa status login pengguna saat ini
        firebase.auth().onAuthStateChanged(function(user) {
          if (user) {
            var username = user.displayName; // Menggunakan displayName pengguna sebagai username
            getFileInfo(username);
          } else {
            console.log('Pengguna belum login');
          }
        });
      
        // Mendapatkan ukuran dan metadata file
        function getFileInfo(username) {
          var storageRef = firebase.storage().ref('/koraa/items/logo/' + username);
          storageRef.listAll().then(function(res) {
            if (res.items.length > 0) {
              var filePromises = res.items.map(function(itemRef) {
                return itemRef.getMetadata().then(function(metadata) {
                  // Mengakses metadata file
                  var namaFile = metadata.name;
                  var ukuranFile = metadata.size;
                  var tanggalUpload = metadata.timeCreated;
      
                  // Mengubah ukuran file menjadi KB, MB, atau GB
                  var ukuranFormatted = formatSize(ukuranFile);
      
                  // Menampilkan informasi file
                  var fileInfoHTML = '<li class="folder-box d-flex align-items-center">' +
                    '<div class="d-flex align-items-center files-list">' +
                    '<div class="flex-shrink-0 file-left"><i class="f-22 fa fa-folder font-primary"></i></div>' +
                    '<div class="flex-grow-1 ms-3">' +
                    '<h6>' + namaFile + '</h6>' +
                    '<p>' + tanggalUpload + ', ' + ukuranFormatted + '</p>' +
                    '</div>' +
                    '</div>' +
                    '</li>';
      
                  return {
                    fileInfoHTML: fileInfoHTML,
                    ukuranFile: ukuranFile
                  };
                });
              });
      
              Promise.all(filePromises).then(function(fileInfoArray) {
                var fileInfoHTML = fileInfoArray.map(function(fileInfoObj) {
                  return fileInfoObj.fileInfoHTML;
                }).join('');
                var totalSize = fileInfoArray.reduce(function(acc, fileInfoObj) {
                  return acc + fileInfoObj.ukuranFile;
                }, 0);
                var totalSizeFormatted = formatSize(totalSize);
      
                // Mendapatkan informasi plan pengguna dari Firestore
                getPlanFromFirestore(username).then(function(plan) {
                  var userPlan = plan || 'free'; // Jika plan kosong, asumsikan sebagai "free"
      
                  var planStorageLimit = getPlanStorageLimit(userPlan);
                  var usedStoragePercentage = ((totalSize / convertSizeToBytes(planStorageLimit)) * 100).toFixed(2);
      
                  var totalSizeInfo =
                  '<ul>' +
                '<li>' +
                    '<div class="btn btn-outline-primary"><i data-feather="database"></i>Storage</div>' +
                        '<div class="m-t-15">' +
                            '<div class="progress sm-progress-bar mb-3">' +
                                '<div class="progress-bar bg-primary" role="progressbar" style="width: ' + usedStoragePercentage + '%" ' +
                                'aria-valuenow="' + usedStoragePercentage + '" aria-valuemin="0" aria-valuemax="100"></div>' +
                            '</div>' +
                        '<h6 class="f-w-500">' + totalSizeFormatted + ' of ' + planStorageLimit + ' used</h6>' +
                    '</div>' +
                '</li>' +
            '</ul>' +
            '<hr>' +
            '<ul>' +
                '<li>' +
                    '<div class="btn btn-outline-primary"><i data-feather="grid"></i>Pricing plan</div>' +
                '</li>' +
                    '<li> </li>' +
                '<div class="pricing-plan">' +
                    '<h6>Trial Version </h6>' +
                    '<h5>' + userPlan.toUpperCase() + '</h5>' +
                    '<p>' + planStorageLimit + ' space</p>' +
                    '<div class="btn btn-outline-primary btn-xs">Selected</div>' +
                    '<img class="bg-img" src="../assets/images/dashboard/folder.png" alt="">' +
                '</div>' +
            '</ul>';

                  document.getElementById('fileList').innerHTML = fileInfoHTML;
                  document.getElementById('totalSizeInfo').innerHTML = totalSizeInfo;
      
                  // Memuat ikon Feather Icons
                  feather.replace();
                }).catch(function(error) {
                  console.error('Error:', error);
                });
              }).catch(function(error) {
                console.error('Error:', error);
              });
            } else {
              console.log('Tidak ada file yang ditemukan');
            }
          }).catch(function(error) {
            console.error('Error:', error);
          });
        }
      
        // Fungsi untuk mengubah ukuran file menjadi KB, MB, atau GB
        function formatSize(size) {
          if (size < 1024) {
            return size + ' bytes';
          } else if (size < 1024 * 1024) {
            return (size / 1024).toFixed(2) + ' KB';
          } else if (size < 1024 * 1024 * 1024) {
            return (size / (1024 * 1024)).toFixed(2) + ' MB';
          } else {
            return (size / (1024 * 1024 * 1024)).toFixed(2) + ' GB';
          }
        }
      
        // Fungsi untuk mendapatkan batas penyimpanan berdasarkan plan
        function getPlanStorageLimit(plan) {
          if (plan === 'free') {
            return '100 GB';
          } else if (plan === 'silver') {
            return '200 GB';
          } else {
            return 'Unknown';
          }
        }
      
        // Fungsi untuk mengubah ukuran penyimpanan dalam byte menjadi satuan yang lebih besar
        function convertSizeToBytes(size) {
          var numericValue = parseFloat(size);
          var unit = size.match(/[a-zA-Z]+/)[0].toLowerCase();
      
          switch (unit) {
            case 'kb':
              return numericValue * 1024;
            case 'mb':
              return numericValue * 1024 * 1024;
            case 'gb':
              return numericValue * 1024 * 1024 * 1024;
            default:
              return numericValue;
          }
        }
      
        // Fungsi untuk mendapatkan informasi plan pengguna dari Firestore
        function getPlanFromFirestore(username) {
          return new Promise(function(resolve, reject) {
            var usersCollectionRef = firebase.firestore().collection('users');
            var userDocRef = usersCollectionRef.doc(username);
            userDocRef.get().then(function(doc) {
              if (doc.exists) {
                var userData = doc.data();
                var plan = userData.plan; // Ganti dengan nama field yang sesuai di Firestore
                resolve(plan);
              } else {
                reject(new Error('Dokumen pengguna tidak ditemukan'));
              }
            }).catch(function(error) {
              reject(error);
            });
          });
        }
      </script>
      
</body>

</html>