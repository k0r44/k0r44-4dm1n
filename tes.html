<!DOCTYPE html>
<html>
<head>
  <title>Read Total Items from Firestore</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
  </style>
</head>
<body>
  <h1>Total Items: <span id="totalItems"></span></h1>

  <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-firestore.js"></script>

  <script>
    // Inisialisasi Firebase
    var firebaseConfig = {
        apiKey: "AIzaSyA_2_DrjTzs1cIOY9_5mloWYcdLxpsFq5c",
    authDomain: "koraa-id.firebaseapp.com",
    databaseURL: "https://koraa-id-default-rtdb.firebaseio.com",
    projectId: "koraa-id",
    storageBucket: "koraa-id.appspot.com",
    messagingSenderId: "360256061577",
    appId: "1:360256061577:web:5d9dbb92ff3313c7b48658",
    measurementId: "G-VJT00SD3NT"
    };

    // Inisialisasi aplikasi Firebase
    firebase.initializeApp(firebaseConfig);

    // Mendapatkan referensi Firestore
    var db = firebase.firestore();

    // Mendapatkan referensi koleksi "users"
    var usersCollection = db.collection("users");

    // Mendapatkan total item dari koleksi "items"
    var itemsCollection = db.collection("items");

    // Mendapatkan total item dari Firestore
    firebase.auth().onAuthStateChanged(function(user) {
      if (user) {
        // UID pengguna yang sedang login
        var uid = user.uid;

        // Mendapatkan referensi dokumen pengguna
        var userRef = usersCollection.doc(uid);

        // Mengambil data pengguna
        userRef.get().then(function(userDoc) {
          if (userDoc.exists) {
            // Mendapatkan UID dari dokumen pengguna
            var userUid = userDoc.data().uid;

            // Mendapatkan total item dari koleksi "items"
            itemsCollection.where("users", "==", userUid, "items").get().then(function(querySnapshot) {
              var totalItems = querySnapshot.size;

              // Menampilkan total item
              document.getElementById("totalItems").textContent = totalItems;
            }).catch(function(error) {
              console.log("Error getting items:", error);
            });
          } else {
            console.log("Dokumen pengguna tidak ditemukan!");
          }
        }).catch(function(error) {
          console.log("Error getting user document:", error);
        });
      } else {
        // Pengguna tidak sedang login, lakukan tindakan lain jika diperlukan
        console.log("Pengguna tidak sedang login");
      }
    });
  </script>
</body>
</html>
