// Get user details elements
var userEmailText = document.getElementsByClassName('user-email');
var userCategoryText = document.getElementsByClassName('user-category');
var usernameText = document.getElementsByClassName('username');
var signupTimeText = document.getElementsByClassName('signup-time');
var loginTimeText = document.getElementsByClassName('login-time');

// Set user details and login time
firebase.auth().onAuthStateChanged(function(user) {
  if (user) {
    var categoryRef = firebase.firestore().collection('users').doc(user.displayName);
    categoryRef.get()
      .then(function(doc) {
        if (doc.exists) {
          userEmailText[0].textContent = user.email;
          userCategoryText[0].textContent = doc.data().category;
          usernameText[0].textContent = doc.data().username;
          signupTimeText[0].textContent = doc.data().signupTime; // Tampilkan waktu pendaftaran
          loginTimeText[0].textContent = new Date().toLocaleString(); // Tampilkan waktu saat ini
        } else {
          userEmailText[0].textContent = "Email not available";
          userCategoryText[0].textContent = "Category not available";
          signupTimeText[0].textContent = "";
          loginTimeText[0].textContent = "User not logged in";

          // Add click event listener to redirect to login page
          loginTimeText[0].addEventListener('click', function() {
            window.location.href = '/auth/login/'; // Replace '/login' with the correct URL for the login page
          });
        }
      })
      .catch(function(error) {
        console.log(error);
      });
  } else {
    userEmailText[0].textContent = "User not logged in";
    userCategoryText[0].textContent = "";
    signupTimeText[0].textContent = "User not logged in";
    loginTimeText[0].textContent = "User not logged in";

    // Add click event listener to redirect to login page
    userEmailText[0].addEventListener('click', function() {
      window.location.href = '/auth/login/'; // Replace '/login' with the correct URL for the login page
    });

    signupTimeText[0].addEventListener('click', function() {
      window.location.href = '/auth/login/'; // Replace '/login' with the correct URL for the login page
    });

    loginTimeText[0].addEventListener('click', function() {
      window.location.href = '/auth/login/'; // Replace '/login' with the correct URL for the login page
    });
  }
});

// Get logout button element
var logoutButton = document.getElementById('logout-button');

// Add event listener to logout button
logoutButton.addEventListener('click', function() {
  firebase.auth().signOut()
    .then(function() {
      // Redirect to the login page after successful logout
      window.location.href = '/auth/login/'; // Replace '/login' with the correct URL for the login page
    })
    .catch(function(error) {
      console.log(error);
    });
});
