<!DOCTYPE html>
<html>
<head>
  <title>Statistik Total View Per Hari</title>
  <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-firestore.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    #chart-container {
      width: 600px;
      margin: 20px auto;
    }
  </style>
</head>
<body>
  <div id="chart-container">
    <canvas id="chart"></canvas>
  </div>

  <script>
    // Inisialisasi Firebase
var firebaseConfig = {
  apiKey: "AIzaSyA_2_DrjTzs1cIOY9_5mloWYcdLxpsFq5c",
    authDomain: "koraa-id.firebaseapp.com",
    databaseURL: "https://koraa-id-default-rtdb.firebaseio.com",
    projectId: "koraa-id",
    storageBucket: "koraa-id.appspot.com",
    messagingSenderId: "360256061577",
    appId: "1:360256061577:web:5d9dbb92ff3313c7b48658",
    measurementId: "G-VJT00SD3NT"
};
firebase.initializeApp(firebaseConfig);

// Mengambil referensi Firestore
var db = firebase.firestore();

// Mengambil data total view per hari dari Firestore
function getTotalViewData() {
  var totalViewData = [];

  // Mengambil koleksi "users"
  db.collection("users").get().then((querySnapshot) => {
    querySnapshot.forEach((doc) => {
      // Mengambil data total view dari setiap dokumen
      var totalView = doc.data().count.view.totalview;
      totalViewData.push(totalView);
    });

    // Menggambar chart menggunakan Chart.js
    drawChart(totalViewData);
  }).catch((error) => {
    console.log("Error getting documents: ", error);
  });
}

// Menggambar chart dengan data yang diberikan
function drawChart(data) {
  var ctx = document.getElementById('chart').getContext('2d');
  var chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: getDatesArray(data.length),
      datasets: [{
        label: 'Total View Per Hari',
        data: data,
        backgroundColor: 'rgba(0, 123, 255, 0.3)',
        borderColor: 'rgba(0, 123, 255, 1)',
        borderWidth: 1
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
}

// Menghasilkan array label dengan tanggal (hari) untuk chart
function getDatesArray(length) {
  var datesArray = [];
  var currentDate = new Date();
  for (var i = length - 1; i >= 0; i--) {
    var date = new Date(currentDate);
    date.setDate(date.getDate() - i);
    datesArray.push(date.toDateString());
  }
  return datesArray;
}

// Memanggil fungsi untuk mengambil data dan menggambar chart
getTotalViewData();

  </script>
</body>
</html>
