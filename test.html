<!DOCTYPE html>
<html>
<head>
  <title>Login and Daftar Firebase</title>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Login and Daftar Firebase</h1>
    <div id="login-form">
      <h2>Masuk</h2>
      <input type="text" id="email" placeholder="Email" required>
      <input type="password" id="password" placeholder="Password" required>
      <button onclick="login(event)">Masuk</button>
    </div>
    <div id="signup-form">
      <h2>Daftar</h2>
      <input type="text" id="new-email" placeholder="Email" required>
      <input type="password" id="new-password" placeholder="Password" required>
      <select id="category" required>
        <option value="">Pilih Kategori</option>
        <option value="code">Code</option>
        <option value="design">Design</option>
      </select>
      <button onclick="signup(event)">Daftar</button>
    </div>
    <div id="success-message"></div>
    <div id="error-message"></div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-firestore.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA_2_DrjTzs1cIOY9_5mloWYcdLxpsFq5c",
authDomain: "koraa-id.firebaseapp.com",
projectId: "koraa-id",
storageBucket: "koraa-id.appspot.com",
messagingSenderId: "360256061577",
appId: "1:360256061577:web:5d9dbb92ff3313c7b48658",
measurementId: "G-VJT00SD3NT"
    };

    firebase.initializeApp(firebaseConfig);
    var db = firebase.firestore();

    // Get elements
    var loginForm = document.getElementById('login-form');
    var signupForm = document.getElementById('signup-form');
    var successMessage = document.getElementById('success-message');
    var errorMessage = document.getElementById('error-message');
    var signupErrorMessage = document.getElementById('signup-error-message');

    // Show login form
    function showLoginForm() {
      loginForm.style.display = 'block';
      signupForm.style.display = 'block';
      successMessage.style.display = 'none';
      errorMessage.style.display = 'none';
      signupErrorMessage.style.display = 'none';
    }

    // Perform login
    function login(event) {
      event.preventDefault(); // Prevent page refresh
      var email = document.getElementById('email').value;
      var password = document.getElementById('password').value;

      firebase.auth().signInWithEmailAndPassword(email, password)
        .then(function(userCredential) {
          var user = userCredential.user;
          var category = user.email.split('@')[0]; // Assuming category is the prefix before the '@' sign in the email
          if (category === 'code') {
            window.location.href = '/c/code/'; // Replace with the correct URL
          } else if (category === 'design') {
            window.location.href = '/items/category/design/application/'; // Replace with the correct URL
          }
        })
        .catch(function(error) {
          errorMessage.innerHTML = error.message;
          errorMessage.style.display = 'block';
        });
    }

    // Perform signup
    function signup(event) {
      event.preventDefault(); // Prevent page refresh
      var email = document.getElementById('new-email').value;
      var password = document.getElementById('new-password').value;
      var category = document.getElementById('category').value;

      firebase.auth().createUserWithEmailAndPassword(email, password)
        .then(function(userCredential) {
          var user = userCredential.user;
          return firebase.firestore().collection('users').doc(user.uid).set({
            email: email,
            category: category
          });
        })
        .then(function() {
          successMessage.innerHTML = 'Akun berhasil dibuat. Silakan masuk.';
          successMessage.style.display = 'block';
          showLoginForm();
        })
        .catch(function(error) {
          signupErrorMessage.innerHTML = error.message;
          signupErrorMessage.style.display = 'block';
        });
    }

    // Check if user is already logged in
firebase.auth().onAuthStateChanged(function(user) {
  if (user) {
    var categoryRef = firebase.firestore().collection('users').doc(user.uid);
    categoryRef.get()
      .then(function(doc) {
        if (doc.exists) {
          var category = doc.data().category;
          if (category === 'code') {
            window.location.href = '/c/code/'; // Replace with the correct URL
          } else if (category === 'design') {
            window.location.href = '/'; // Replace with the correct URL
          }
        } else {
          showLoginForm();
        }
      })
      .catch(function(error) {
        showLoginForm();
      });
  } else {
    // User is not logged in, redirect to login page
    window.location.href = '/test.html'; // Replace with the correct URL of your login page
  }
});
  </script>
</body>
</html>
