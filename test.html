<!DOCTYPE html>
<html>
<head>
  <title>Submit Button with Firestore Image URL</title>
  <script src="https://www.gstatic.com/firebasejs/9.4.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.4.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.4.0/firebase-storage.js"></script>
</head>
<body>
  <input type="file" id="input-file" accept="image/*">
  <button id="upload-button">Upload</button>
  <input type="text" id="input-image" readonly>
  <button id="submit-button" disabled>Submit</button>

  <script>
    // Konfigurasi Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyA_2_DrjTzs1cIOY9_5mloWYcdLxpsFq5c",
    authDomain: "koraa-id.firebaseapp.com",
    databaseURL: "https://koraa-id-default-rtdb.firebaseio.com",
    projectId: "koraa-id",
    storageBucket: "koraa-id.appspot.com",
    messagingSenderId: "360256061577",
    appId: "1:360256061577:web:5d9dbb92ff3313c7b48658",
    measurementId: "G-VJT00SD3NT"
    };

    // Menginisialisasi Firebase
    firebase.initializeApp(firebaseConfig);

    // Mendapatkan referensi elemen input, tombol upload, dan tombol submit
    const inputFile = document.getElementById('input-file');
    const uploadButton = document.getElementById('upload-button');
    const inputImage = document.getElementById('input-image');
    const submitButton = document.getElementById('submit-button');

    // Membuat fungsi untuk memeriksa perubahan pada elemen input
    function checkImageURL() {
      const imageURL = inputImage.value.trim();

      // Memeriksa apakah URL image Firestore terisi
      if (imageURL !== '') {
        // Mengaktifkan tombol submit
        submitButton.disabled = false;
      } else {
        // Menonaktifkan tombol submit
        submitButton.disabled = true;
      }
    }

    // Menambahkan event listener untuk memantau perubahan pada elemen input
    inputImage.addEventListener('input', checkImageURL);

    // Menambahkan event listener untuk tombol upload
    uploadButton.addEventListener('click', () => {
      inputFile.click();
    });

    // Menambahkan event listener untuk input file
    inputFile.addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (file) {
        const storageRef = firebase.storage().ref();
        const imageRef = storageRef.child(file.name);

        // Mengunggah file gambar ke Firebase Storage
        imageRef.put(file)
          .then(() => {
            console.log('Gambar berhasil diunggah ke Firebase Storage.');
            return imageRef.getDownloadURL();
          })
          .then((url) => {
            inputImage.value = url;
            checkImageURL();
          })
          .catch((error) => {
            console.error('Terjadi kesalahan saat mengunggah gambar:', error);
          });
      }
    });

    // Menambahkan event listener untuk tombol submit
    submitButton.addEventListener('click', () => {
      const imageURL = inputImage.value.trim();
      if (imageURL !== '') {
        // Menyimpan URL image Firestore ke dalam database
        const db = firebase.firestore();
        db.collection('images').add({
          imageURL: imageURL
        })
        .then(() => {
          console.log('URL image berhasil disimpan di Firestore.');
          // Lakukan tindakan lain yang diinginkan setelah menyimpan URL
        })
        .catch((error) => {
          console.error('Terjadi kesalahan saat menyimpan URL image:', error);
        });
      }
    });
  </script>
</body>
</html>
