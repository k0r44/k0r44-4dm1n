<!DOCTYPE html>
<html>
<head>
  <title>Login and Daftar Firebase</title>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Login and Daftar Firebase</h1>
    <div id="login-form">
      <h2>Masuk</h2>
      <form id="loginForm">
        <input type="email" id="email" placeholder="Email" required>
        <input type="password" id="password" placeholder="Password" required>
        <button type="submit">Masuk</button>
      </form>
    </div>
    <div id="signup-form">
      <h2>Daftar</h2>
      <input type="email" id="new-email" placeholder="Email" required>
      <input type="password" id="new-password" placeholder="Password" required>
      <select id="category" required>
        <option value="">Pilih Kategori</option>
        <option value="code">Code</option>
        <option value="design">Design</option>
      </select>
      <button onclick="signup()">Daftar</button>
    </div>
    <div id="success-message"></div>
    <div id="error-message"></div>
  </div>

  <div id="category-content"></div>

  <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-firestore.js"></script>
  <script>
    const firebaseConfig = {
        apiKey: "AIzaSyA_2_DrjTzs1cIOY9_5mloWYcdLxpsFq5c",
authDomain: "koraa-id.firebaseapp.com",
projectId: "koraa-id",
storageBucket: "koraa-id.appspot.com",
messagingSenderId: "360256061577",
appId: "1:360256061577:web:5d9dbb92ff3313c7b48658",
measurementId: "G-VJT00SD3NT"
    };

    firebase.initializeApp(firebaseConfig);
    var db = firebase.firestore();

    // Get elements
    var loginForm = document.getElementById('loginForm');
    var emailInput = document.getElementById('email');
    var passwordInput = document.getElementById('password');
    var errorMessage = document.getElementById('error-message');
    var categoryContent = document.getElementById('category-content');

    // Perform login
    function login() {
      var email = emailInput.value;
      var password = passwordInput.value;

      firebase.auth().signInWithEmailAndPassword(email, password)
        .then(function(userCredential) {
          var user = userCredential.user;
          var category = user.email.split('@')[0]; // Mengasumsikan kategori adalah awalan sebelum tanda '@' dalam email
          loadCategoryPage(category); // Memuat halaman kategori secara dinamis menggunakan AJAX
        })
        .catch(function(error) {
          errorMessage.innerHTML = error.message;
          errorMessage.style.display = 'block';
        });
    }

    // Tambahkan event listener ke tombol submit pada formulir login
    loginForm.addEventListener('submit', function(event) {
      event.preventDefault(); // Mencegah pengiriman formulir
      login(); // Panggil fungsi login
    });

    // Perform signup
    function signup() {
      var email = document.getElementById('new-email').value;
      var password = document.getElementById('new-password').value;
      var category = document.getElementById('category').value;

      firebase.auth().createUserWithEmailAndPassword(email, password)
        .then(function(userCredential) {
          var user = userCredential.user;
          return firebase.firestore().collection('users').doc(user.uid).set({
            email: email,
            category: category
          });
        })
        .then(function() {
          successMessage.innerHTML = 'Akun berhasil dibuat. Silakan masuk.';
          successMessage.style.display = 'block';
          loadCategoryPage(category); // Memuat halaman kategori secara dinamis menggunakan AJAX
        })
        .catch(function(error) {
          errorMessage.innerHTML = error.message;
          errorMessage.style.display = 'block';
        });
    }

    // Load category page dynamically using AJAX
    function loadCategoryPage(category) {
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          categoryContent.innerHTML = this.responseText;
        }
      };
      xhttp.open('GET', '/c/' + category + '/', true); // Ganti dengan URL yang benar untuk halaman kategori
      xhttp.send();
    }

    // Check if user is already logged in
    firebase.auth().onAuthStateChanged(function(user) {
      if (user) {
        var categoryRef = firebase.firestore().collection('users').doc(user.uid);
        categoryRef.get()
          .then(function(doc) {
            if (doc.exists) {
              var category = doc.data().category;
              loadCategoryPage(category); // Memuat halaman kategori secara dinamis menggunakan AJAX
            } else {
              showLoginForm();
            }
          })
          .catch(function(error) {
            showLoginForm();
          });
      } else {
        showLoginForm();
      }
    });

    // Show login form
    function showLoginForm() {
      loginForm.style.display = 'block';
      signupForm.style.display = 'block';
      successMessage.style.display = 'none';
      errorMessage.style.display = 'none';
      categoryContent.innerHTML = '';
    }
  </script>
</body>
</html>
